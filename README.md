# üîê SFTP Cluster Automation & Logging System

## üß© –û–ø–∏—Å

–¶–µ–π –ø—Ä–æ—î–∫—Ç —Ä–µ–∞–ª—ñ–∑—É—î –∫–ª–∞—Å—Ç–µ—Ä —ñ–∑ —Ç—Ä—å–æ—Ö –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –º–∞—à–∏–Ω –∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º–∏ SFTP-—Å–µ—Ä–≤–µ—Ä–∞–º–∏. –ö–æ–∂–Ω–∞ –º–∞—à–∏–Ω–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ —ñ–Ω—à–∏–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é SSH-–∫–ª—é—á—ñ–≤. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ Bash-—Å–∫—Ä–∏–ø—Ç–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å —Ñ–∞–π–ª–∏ –Ω–∞ —Å—É—Å—ñ–¥–Ω—ñ—Ö –≤—É–∑–ª–∞—Ö, –∞ Python-–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ñ–æ—Ä–º—É—î –∑–≤—ñ—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ª–æ–≥—ñ–≤. –î–æ–¥–∞—Ç–∫–æ–≤–æ –≤–∏–∫–æ–Ω–∞–Ω–æ –±–∞–∑–æ–≤–∏–π —Å–µ–∫—é—Ä—ñ—Ç—ñ –∞—É–¥–∏—Ç –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `rkhunter`.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

‚îú‚îÄ‚îÄ Vagrantfile # –û–ø–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è 3 VM ‚îú‚îÄ‚îÄ provisioning/ ‚îÇ ‚îú‚îÄ‚îÄ install_sftp.sh # –Ü–Ω—Å—Ç–∞–ª—è—Ü—ñ—è SFTP —ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SSH ‚îÇ ‚îî‚îÄ‚îÄ setup_cron.sh # Bash-–ª–æ–≥–µ—Ä —ñ cron task ‚îú‚îÄ‚îÄ scripts/ ‚îÇ ‚îî‚îÄ‚îÄ write_to_peers.sh # –°–∫—Ä–∏–ø—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –Ω–∞ —Å—É—Å—ñ–¥–∞—Ö ‚îú‚îÄ‚îÄ analyzer/ ‚îÇ ‚îú‚îÄ‚îÄ analyzer.py # Python-–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –ª–æ–≥—ñ–≤ ‚îÇ ‚îî‚îÄ‚îÄ Dockerfile # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π Docker-–æ–±—Ä–∞–∑ ‚îú‚îÄ‚îÄ output/ ‚îÇ ‚îî‚îÄ‚îÄ report.csv # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç ‚îî‚îÄ‚îÄ README.md # –¶–µ–π —Ñ–∞–π–ª

markdown
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏

---

## üöÄ –Ø–∫ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

### üîß –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- [Vagrant](https://www.vagrantup.com/downloads)
- [VirtualBox](https://www.virtualbox.org/)
- Docker (–æ–ø—Ü—ñ–π–Ω–æ, –¥–ª—è –∑–∞–ø—É—Å–∫—É –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ)

### üì• –ö—Ä–æ–∫–∏ –∑–∞–ø—É—Å–∫—É

1. **–ö–ª–æ–Ω—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π**
   ```bash
   git clone https://github.com/your-repo/sftp-cluster.git
   cd sftp-cluster
–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä –∑ 3 VM

bash
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
vagrant up
–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –±—É–¥—å-—è–∫–æ—ó VM

bash
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
vagrant ssh node1
–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É —Å–∫—Ä–∏–ø—Ç—ñ–≤

bash
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
cat /var/log/sftp-write.log
üõ† Bash-–ª–æ–≥–µ—Ä
–°–∫—Ä–∏–ø—Ç write_to_peers.sh:

–∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω —á–µ—Ä–µ–∑ cron

—Å—Ç–≤–æ—Ä—é—î —Ñ–∞–π–ª –Ω–∞ —ñ–Ω—à–∏—Ö 2-—Ö –º–∞—à–∏–Ω–∞—Ö

—Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É: log_<timestamp>_<hostname>.txt

–º—ñ—Å—Ç–∏—Ç—å –¥–∞—Ç—É, —á–∞—Å —Ç–∞ —ñ–º‚Äô—è –º–∞—à–∏–Ω–∏

–§–∞–π–ª –ª–æ–≥—É: /var/log/sftp-write.log

üìä Python-–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –ª–æ–≥—ñ–≤
üìÑ –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:
—á–∏—Ç–∞—î –≤—Å—ñ –ª–æ–≥–∏ –∑ /var/log/sftp-write.log –Ω–∞ –∫–æ–∂–Ω—ñ–π –º–∞—à–∏–Ω—ñ

–∞–≥—Ä–µ–≥—É—î –¥–∞–Ω—ñ: —è–∫–∞ –º–∞—à–∏–Ω–∞, –∑ —è–∫–æ—ó IP-–∞–¥—Ä–µ—Å–∏, —Å–∫—ñ–ª—å–∫–∏ –∑–∞–ø–∏—Å—ñ–≤ –∑—Ä–æ–±–∏–ª–∞

—Ñ–æ—Ä–º—É—î –∑–≤—ñ—Ç —É report.csv

‚öôÔ∏è –ó–∞–ø—É—Å–∫ —É Docker:
bash
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
cd analyzer
docker build -t log-analyzer .
docker run --rm -v $(pwd)/../output:/output log-analyzer
–†–µ–∑—É–ª—å—Ç–∞—Ç: output/report.csv

üß™ –ë–µ–∑–ø–µ–∫–æ–≤–∏–π –∞—É–¥–∏—Ç
–ù–∞ –∫–æ–∂–Ω—ñ–π –º–∞—à–∏–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ rkhunter. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥:

bash
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
sudo cat /var/log/rkhunter.log
üìÖ –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ (cron)
–î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ vagrant:

bash
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
crontab -l
–û—á—ñ–∫—É–≤–∞–Ω–∏–π –∑–∞–ø–∏—Å:

swift
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
*/5 * * * * /home/vagrant/write_to_peers.sh >> /var/log/sftp-write.log 2>&1
üìà –§–æ—Ä–º–∞—Ç –∑–≤—ñ—Ç—É
report.csv:

Hostname	IP Address	Total Writes
node1	192.168.56.10	42
node2	192.168.56.11	39
node3	192.168.56.12	40
üîß Troubleshooting
VM –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä –ø–æ—Ä—Ç–∏ –∞–±–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ vagrant destroy && vagrant up

–§–∞–π–ª–∏ –Ω–µ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä –¥–æ—Å—Ç—É–ø –ø–æ SSH –º—ñ–∂ –º–∞—à–∏–Ω–∞–º–∏

Cron –Ω–µ –ø—Ä–∞—Ü—é—î ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä –∂—É—Ä–Ω–∞–ª sudo grep CRON /var/log/syslog

üìö –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
Vagrant Docs

rkhunter Docs

Cron Basics

üë®‚Äçüíª –ê–≤—Ç–æ—Ä:
[–í—Å—è–∫–∏–π –ú–∏—Ä–æ—Å–ª–∞–≤ –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á]
NOC Engineer | Automation Enthusiast
